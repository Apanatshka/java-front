<?xml version="1.0" encoding="UTF-8" ?>
<project name="Java" default="all">
	<!-- Key input modules -->
	<property name="sdfmodule" value="Java" />
	<property name="metasdfmodule" value="Stratego-Java" />
	<property name="esvmodule" value="Java" />
	<property name="strmodule" value="java" />

	<!-- Project directories -->
	<property name="trans" location="trans" />
	<property name="src-gen" location="editor/java" />
	<property name="syntax" location="syntax" />
	<property name="include" location="include" />
	<property name="lib" location="lib" />
	<property name="build" location="bin" />
	<property name="dist" location="bin/dist" />

	<!-- Sublanguage directories -->
	<property name="arrays.dir" location="languages/Java-1.5/arrays" />
	<property name="classes.dir" location="languages/Java-1.5/classes" />
	<property name="expressions.dir" location="languages/Java-1.5/expressions" />
	<property name="interfaces.dir" location="languages/Java-1.5/interfaces" />
	<property name="lexical.dir" location="languages/Java-1.5/lexical" />
	<property name="literals.dir" location="languages/Java-1.5/literals" />
	<property name="names.dir" location="languages/Java-1.5/names" />
	<property name="packages.dir" location="languages/Java-1.5/packages" />
	<property name="statements.dir" location="languages/Java-1.5/statements" />
	<property name="types.dir" location="languages/Java-1.5/types" />

	<!-- Imports -->
	<property name="build.sdf.imports" value="
    -I &quot;${arrays.dir}/syntax&quot;
    -I &quot;${classes.dir}/syntax&quot;
    -I &quot;${expressions.dir}/syntax&quot;
    -I &quot;${interfaces.dir}/syntax&quot;
    -I &quot;${lexical.dir}/syntax&quot;
  	-I &quot;${literals.dir}/syntax&quot;
    -I &quot;${names.dir}/syntax&quot;
    -I &quot;${packages.dir}/syntax&quot;
    -I &quot;${statements.dir}/syntax&quot;
    -I &quot;${types.dir}/syntax&quot;
  " />

	<property name="build.stratego.args" value="
    --library
    -I &quot;${trans}&quot;
    -I &quot;${basedir}&quot;
    -la stratego-lib -la stratego-sglr -la stratego-gpp -la stratego-xtc -la stratego-aterm -la stratego-parallel" />

	<!-- Environment configuration for command-line builds -->
	<condition property="build.strategoxt.sdf" value="${eclipse.spoofaximp.nativeprefix}" else="">
		<isset property="eclipse.spoofaximp.nativeprefix" />
	</condition>
	<property name="build.strategoxt.stratego" location="${user.home}/.nix-profile/bin" />

	<!-- used for building inside of Eclipse -->
	<import file="build.generated.xml" />

	<!-- Main target -->
	<target name="all" depends="link-lib-files, copy-lib-files, spoofaximp.default.ctree" />

	<target name="os-detection">
		<condition property="isWin">
			<os family="windows" />
		</condition>
	</target>

	<target name="copy-lib-files" if="isWin" depends="os-detection">
		<copy todir="${basedir}/lib/nabl">
			<fileset dir="${basedir}/../../runtime-libraries/org.spoofax.meta.runtime.libraries/nabl/" includes="**" />
		</copy>
		<copy todir="${basedir}/lib/index">
			<fileset dir="${basedir}/../../runtime-libraries/org.spoofax.meta.runtime.libraries/index/" includes="**" />
		</copy>
		<copy todir="${basedir}/lib/task">
			<fileset dir="${basedir}/../../runtime-libraries/org.spoofax.meta.runtime.libraries/task/" includes="**" />
		</copy>
		<copy todir="${basedir}/lib/properties">
			<fileset dir="${basedir}/../../runtime-libraries/org.spoofax.meta.runtime.libraries/properties/" includes="**" />
		</copy>
		<copy todir="${basedir}/lib/types">
			<fileset dir="${basedir}/../../runtime-libraries/org.spoofax.meta.runtime.libraries/types/" includes="**" />
		</copy>
		<copy todir="${basedir}/lib/analysis">
			<fileset dir="${basedir}/../../runtime-libraries/org.spoofax.meta.runtime.libraries/analysis/" includes="**" />
		</copy>
		<copy todir="${basedir}/lib/editor">
			<fileset dir="${basedir}/../../runtime-libraries/org.spoofax.meta.runtime.libraries/editor/" includes="**" />
		</copy>
		<copy todir="${basedir}/lib/tmpl">
			<fileset dir="${basedir}/../../runtime-libraries/org.spoofax.meta.runtime.libraries/tmpl/" includes="**" />
		</copy>
	</target>

	<target name="link-lib-files" unless="isWin" depends="os-detection">
		<symlink resource="${basedir}/../../runtime-libraries/org.spoofax.meta.runtime.libraries/nabl/" link="${basedir}/lib/nabl" overwrite="true" />
		<symlink resource="${basedir}/../../runtime-libraries/org.spoofax.meta.runtime.libraries/index/" link="${basedir}/lib/index" overwrite="true" />
		<symlink resource="${basedir}/../../runtime-libraries/org.spoofax.meta.runtime.libraries/task/" link="${basedir}/lib/task" overwrite="true" />
		<symlink resource="${basedir}/../../runtime-libraries/org.spoofax.meta.runtime.libraries/properties/" link="${basedir}/lib/properties" overwrite="true" />
		<symlink resource="${basedir}/../../runtime-libraries/org.spoofax.meta.runtime.libraries/types/" link="${basedir}/lib/types" overwrite="true" />
		<symlink resource="${basedir}/../../runtime-libraries/org.spoofax.meta.runtime.libraries/analysis/" link="${basedir}/lib/analysis" overwrite="true" />
		<symlink resource="${basedir}/../../runtime-libraries/org.spoofax.meta.runtime.libraries/editor/" link="${basedir}/lib/editor" overwrite="true" />
		<symlink resource="${basedir}/../../runtime-libraries/org.spoofax.meta.runtime.libraries/tmpl/" link="${basedir}/lib/tmpl" overwrite="true" />
	</target>
</project>