module languages/Java-1.5/types/types/conversion

imports
	
	include/Java
	lib/task/-
	lib/types/-
	
signature
	
	constructors
		
		IdentityConversion          : Relation
		WideningPrimitiveConversion : Relation
	
rules // Identity conversion
	
	convert-identity(|ctx, dep):
		(t1, t2) -> <type-match(|ctx, IdentityConversion(), dep)> (t1, t2)
	convert-identity(|ctx) = convert-identity(|ctx, [])
	
	nabl-property-eq:
		(Type(), IdentityConversion(), (x, x)) -> x

rules // Widening primitive conversions
	
	convert-widening-primitive(|ctx, dep):
		(t1, t2) -> task
		with
		  conv1 := <type-match(|ctx, WideningPrimitiveConversion(), dep)> (t1, t2)
		; conv2 := <type-match(|ctx, WideningPrimitiveConversion(), dep)> (t2, t1)
		; task  := <new-task(|ctx)> Choice([conv1, conv2])
	convert-widening-primitive(|ctx) = convert-widening-primitive(|ctx, [])
	
	nabl-property-eq: (Type(), WideningPrimitiveConversion(), (Byte(), t@Short() )) -> t
	nabl-property-eq: (Type(), WideningPrimitiveConversion(), (Byte(), t@Int()   )) -> t
	nabl-property-eq: (Type(), WideningPrimitiveConversion(), (Byte(), t@Long()  )) -> t
	nabl-property-eq: (Type(), WideningPrimitiveConversion(), (Byte(), t@Float() )) -> t
	nabl-property-eq: (Type(), WideningPrimitiveConversion(), (Byte(), t@Double())) -> t

	nabl-property-eq: (Type(), WideningPrimitiveConversion(), (Short(), t@Int()   )) -> t
	nabl-property-eq: (Type(), WideningPrimitiveConversion(), (Short(), t@Long()  )) -> t
	nabl-property-eq: (Type(), WideningPrimitiveConversion(), (Short(), t@Float() )) -> t
	nabl-property-eq: (Type(), WideningPrimitiveConversion(), (Short(), t@Double())) -> t
	
	nabl-property-eq: (Type(), WideningPrimitiveConversion(), (Char(), t@Int()   )) -> t
	nabl-property-eq: (Type(), WideningPrimitiveConversion(), (Char(), t@Long()  )) -> t
	nabl-property-eq: (Type(), WideningPrimitiveConversion(), (Char(), t@Float() )) -> t
	nabl-property-eq: (Type(), WideningPrimitiveConversion(), (Char(), t@Double())) -> t
	
	nabl-property-eq: (Type(), WideningPrimitiveConversion(), (Int(), t@Long()  )) -> t
	nabl-property-eq: (Type(), WideningPrimitiveConversion(), (Int(), t@Float() )) -> t
	nabl-property-eq: (Type(), WideningPrimitiveConversion(), (Int(), t@Double())) -> t
	
	nabl-property-eq: (Type(), WideningPrimitiveConversion(), (Long(), t@Float() )) -> t
	nabl-property-eq: (Type(), WideningPrimitiveConversion(), (Long(), t@Double())) -> t
	
	nabl-property-eq: (Type(), WideningPrimitiveConversion(), (Float(), t@Double() )) -> t
